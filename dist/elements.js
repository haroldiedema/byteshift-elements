!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ByteshiftElements={})}(this,(function(e){"use strict";class t extends HTMLElement{constructor(e,t){super(),this.__attributes__={},this.__constructor__={c:e,o:t}}$nextTick(){return new Promise((e=>window.setTimeout((()=>e()),0)))}connectedCallback(){if(this.isConnected){if(void 0===this.__component__){const e=this.__constructor__.c,t=this.__constructor__.o;delete this.__constructor__,this.__component__=new e(this,t)}Object.keys(this.__attributes__).forEach((e=>{this.__component__[e]=this.__attributes__[e]})),this.__component__.__observer__.connect(),this.__component__.onCreate()}}disconnectedCallback(){this.__component__&&(this.__component__.onDestroy(),this.__component__.__observer__.disconnect())}attributeChangedCallback(e,t,o){const n=e.replace(/([-_][a-z])/g,(e=>e.toUpperCase().replace("-","").replace("_",""))),r=n.charAt(0).toLowerCase()+n.substr(1);t!==o&&(this.__attributes__[r]=o,this.__component__&&(this.__component__[r]=o))}}const o=new Set;function n(e,t,o){const n=t.getAttribute("bind"),r=t.tagName.toLowerCase();if(!e.hasProperty(n))throw new Error(`Cannot bind ${t.tagName.toLowerCase()} element to property ${n}. This property does not exist.`);if("input"!==r)return"textarea"===r?function(e,t,o,n){e.registerNodeEventListener(t,"change",(()=>{n[o]!==t.value&&(n[o]=t.value)})),e.registerNodeEventListener(t,"input",(()=>{n[o]!==t.value&&(n[o]=t.value)}));const r=e=>{t.value!==e&&(t.value=e)};e.addPropertyListener(o,r),r(n[o])}(e,t,n,o):"select"===r?function(e,t,o,n){if(t.hasAttribute("items")){const r=t.getAttribute("items");if(!e.hasProperty(r))throw new Error(`The items property "${r}" does not exist on the component ${e.component.constructor.name}.`);const s=()=>{const e=n[r],s=t.getAttribute("value-name")||"value",i=t.getAttribute("label-name")||"label";if(t.innerHTML="",Array.isArray(e))e.forEach((e=>{const o=document.createElement("option");"object"==typeof e?(o.innerText=e[i],o.value=e[s]):(o.innerText=e,o.value=e),t.appendChild(o)}));else{if("object"!=typeof e)throw new Error(`Items property ${r} must be either an array or object.`);Object.keys(e).forEach((o=>{const n=document.createElement("option");n.innerText=o,n.value=e[o],t.appendChild(n)}))}t.value=n[o]};e.addPropertyListener(r,s),s()}e.registerNodeEventListener(t,"change",(()=>{n[o]!==t.value&&(n[o]=t.value)}));const r=e=>{t.value!==e&&(t.value=e)};e.addPropertyListener(o,r),r(n[o])}(e,t,n,o):void 0;{const r=(t.getAttribute("type")||"text").toLowerCase(),s=t;switch(r){case"checkbox":return void function(e,t,o,n){e.registerNodeEventListener(t,"change",(()=>{n[o]!==t.checked&&(n[o]=t.checked)})),e.addPropertyListener(o,(e=>{t.checked!==e&&(t.checked=e)})),t.checked=!!n[o]}(e,s,n,o);case"text":case"password":case"color":return void function(e,t,o,n){e.registerNodeEventListener(t,"input",(()=>{n[o]!==t.value&&(n[o]=t.value)})),e.registerNodeEventListener(t,"change",(()=>{n[o]!==t.value&&(n[o]=t.value)})),e.addPropertyListener(o,(e=>{t.checked!==e&&(t.checked=e)})),t.value=n[o],t.setAttribute("value",n[o])}(e,s,n,o);case"number":return void function(e,t,o,n){e.registerNodeEventListener(t,"input",(()=>{const e=parseFloat(t.value);n[o]!==e&&(n[o]=e)})),e.addPropertyListener(o,(e=>{t.checked!==e&&(t.checked=e)})),t.value=n[o]}(e,s,n,o);case"radio":return void function(e,t,o,n){e.registerNodeEventListener(t,"change",(()=>{n[o]!==t.value&&(n[o]=t.value)}));const r=e=>{e===t.value?t.checked||(t.checked=!0):t.checked&&(t.checked=!1)};e.addPropertyListener(o,r),r(n[o])}(e,s,n,o);default:console.warn(`Unknown input element type: "${r}".`)}}}class r{constructor(e,t){this.component=e,this.root=t,this.properties=new Map,this.computedProperties=new Map,this.nodeEventMap=new Map,this.conditionals=new Set}connect(){this._initializeComponentReactivity();const e=this._iterateNode(this.root,this.component);void 0!==this.component.constructor.__observerFunctions__&&this.component.constructor.__observerFunctions__.forEach((e=>{if(!this.properties.has(e.propertyName))throw new Error(`Cannot watch property "${e.propertyName}" through function ${e.method}, because this property does not exist.`);let t=!1;if(this.properties.get(e.propertyName).listeners.add((o=>{t||(t=!0,this.component[e.method](o),t=!1)})),e.immediate){if(t)return;t=!0,this.component[e.method](this.properties.get(e.propertyName).value),t=!1}})),e.forEach((e=>this._injectPropertyReference(e.node,e.ctx))),e.clear(),this.conditionals.forEach((e=>e())),this.conditionals.clear()}disconnect(){this.nodeEventMap.forEach(((e,t)=>{e.forEach(((e,o)=>{e.forEach((e=>{t.removeEventListener(o,e)}))}))})),this.nodeEventMap.clear()}hasProperty(e){return this.properties.has(e)}addPropertyListener(e,t){if(!this.hasProperty(e))throw new Error('Property "'+e+'" does not exist.');this.properties.get(e).listeners.add(t)}registerNodeEventListener(e,t,o){this.nodeEventMap.has(e)||this.nodeEventMap.set(e,new Map),this.nodeEventMap.get(e).has(t)||this.nodeEventMap.get(e).set(t,new Set),this.nodeEventMap.get(e).get(t).add(o),e.addEventListener(t,o)}_iterateNode(e,t,o=new Set){if(!e.hasAttribute||!e.hasAttribute("iterate")){if(e.childNodes.forEach((e=>this._iterateNode(e,t,o))),this._nodeHasPropertyReference(e)&&o.add({node:e,ctx:t}),1===e.nodeType){const o=e;this._bindEventHandlersToNode(o,t),this._bindConditionalsToNode(o,t),this._bindPropertiesToNode(o,t),this._bindEvaluatedAttributesToNode(o,t),this._bindReactiveStyleToNode(o,t),this._bindReactiveClassesToNode(o,t)}return o}this._createElementIterator(e,t)}_bindReactiveClassesToNode(e,t){if(!e.hasAttribute(":class"))return;const o=e.getAttribute(":class"),n=this._findDependenciesInFragment(o),r=new Function("obj","node",`with(obj) {\n            const data = ${o};\n            Object.keys(data).forEach((key) => {\n                if (data[key]) {\n                    if (! node.classList.contains(key)) {\n                        node.classList.add(key);\n                    }\n                } else {\n                    if (node.classList.contains(key)) {\n                        node.classList.remove(key);\n                    }\n                }\n            });\n        }`),s=()=>r(t,e);n.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),s()}_bindEvaluatedAttributesToNode(e,t){const o=e.getAttributeNames().filter((e=>e.startsWith(":")&&":style"!==e&&":class"!==e)).map((e=>e.substr(1)));0!==o.length&&o.forEach((o=>{const n=e.getAttribute(":"+o),r=new Function("obj",`with(obj) { return ${n}; }`),s=this._findDependenciesInFragment(n),i=()=>{e.setAttribute(o,r(t))};s.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(i),this.computedProperties.has(e)&&this.computedProperties.get(e).add(i)})),i()}))}_createElementIterator(e,t){t=t||this.component;const o=e.getAttribute("iterate"),n=document.createComment("iterator:"+o),r=o.split(" in "),s=r[0].trim(),i=r[1].trim();if(e.removeAttribute("iterate"),e.replaceWith(n),!s||!i)throw new Error(`Invalid syntax in iterate directive. Expected "item in items", got "${o}"`);if(!this.hasProperty(i.trim()))throw new Error(`Property "${i}" does not exist in ${this.component.constructor.name}.`);const a=new Map,c=()=>{const o=t[i],r=new Set;let c=n;for(let i=0;i<o.length;i++){const h=o[i];if(r.add(h),a.has(h)){c=a.get(h);continue}const d=e.cloneNode(!0),p=Object.assign(t,{[s]:h});a.set(h,d),n.parentNode.insertBefore(d,c.nextSibling),c=d;const u=this._iterateNode(d,p);u.forEach((e=>this._injectPropertyReference(e.node,e.ctx))),u.clear()}const h=[];a.forEach(((e,t)=>{r.has(t)||h.push(t)})),h.forEach((e=>{a.get(e).remove(),a.delete(e)})),h.length=0,r.clear()};this.properties.get(i).listeners.add(c),c()}_bindReactiveStyleToNode(e,t){if(!e.hasAttribute(":style"))return;const o=e.getAttribute(":style"),n=this._findDependenciesInFragment(o),r=new Function("obj","node",`with(obj) {\n            const data = ${o};\n            Object.keys(data).forEach((key) => {\n                node.style[key] = data[key];\n            });\n        }`),s=()=>r(t,e);n.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),s()}_bindPropertiesToNode(e,t){e.hasAttribute("bind")&&n(this,e,t)}_bindConditionalsToNode(e,t){if(!e.hasAttribute("if"))return;const o=e.getAttribute("if"),n=new Function("obj",`with(obj) { return ${o}; }`),r=document.createComment(`{${e.tagName.toLowerCase()}}.if:(${o})`),s=this._findDependenciesInFragment(o),i=()=>{n(t)?r.parentNode&&r.replaceWith(e):e.replaceWith(r)};s.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(i),this.computedProperties.has(e)&&this.computedProperties.get(e).add(i)})),this.conditionals.add(i)}_bindEventHandlersToNode(e,t){const o=e.getAttributeNames();this.nodeEventMap.has(e)||this.nodeEventMap.set(e,new Map);for(let n=0;n<o.length;n++)if(o[n].startsWith("@")){let r=e.getAttribute(o[n]);"function"==typeof this.component[r]&&(r+="($event instanceof CustomEvent ? $event.detail : $event)");const s=o[n].substr(1).toLowerCase(),i=new Function("obj","$event",`with(obj) { return ${r}; }`),a=e=>i(t,e);this.nodeEventMap.get(e).has(s)||this.nodeEventMap.get(e).set(s,new Set),this.nodeEventMap.get(e).get(s).add(a),e.addEventListener(s,a)}}_initializeComponentReactivity(){const e=(e,t)=>{void 0!==t.value&&"function"!=typeof t.value&&this._createReactiveProperty(e,t),"function"==typeof t.get&&this._createComputedProperty(e,t)},t=Object.getOwnPropertyDescriptors(this.component),o=Object.getOwnPropertyDescriptors(this.component.constructor.prototype);Object.keys(t).forEach((o=>e(o,t[o]))),Object.keys(o).forEach((t=>e(t,o[t])))}_createReactiveProperty(e,t){if(this.properties.has(e))return;this.properties.set(e,{name:e,value:void 0,listeners:new Set});const o=this.component[e];Object.defineProperty(this.component,e,{configurable:!0,enumerable:!0,get:()=>this.properties.get(e).value,set:t=>{const o=this.properties.get(e);o.value=t,o.listeners.forEach((e=>e(o.value))),Array.isArray(t)&&this._bindCallbackOnArrayModifications(t,(()=>{o.listeners.forEach((e=>e(o.value)))}))}}),this.component[e]=o}_bindCallbackOnArrayModifications(e,t){["pop","push","reverse","shift","unshift","splice","sort"].forEach((o=>{e[o]=function(){const n=Array.prototype[o].apply(e,arguments);return t.apply(e,arguments),n}}))}_createComputedProperty(e,t){if(this.computedProperties.has(e))return;let o,n=t.get.toString(),r=/this\.([A-Za-z0-9_]+)/gim,s=[];for(;o=r.exec(n);){const e=o[1].trim();this.properties.has(e)&&s.push(e)}this.computedProperties.set(e,new Set),s.forEach((t=>{this.properties.get(t).listeners.add((()=>{this.computedProperties.get(e).forEach((e=>e()))}))}))}_nodeHasPropertyReference(e){return 3===e.nodeType&&-1!==e.textContent.indexOf("{{")&&-1!==e.textContent.indexOf("}}")}_injectPropertyReference(e,t){let o=e.textContent,n="",r=[];for(let e=0;e<o.length;e++){const s=o[e],i=o[e+1];if("{"!==s||"{"!==i)if("}"!==s||"}"!==i)n+=s;else{e+=1;const o=n.trim();r.push(this._createReactiveTextNode(o,t)),n=""}else e+=1,r.push(document.createTextNode(n)),n=""}n.length>0&&r.push(document.createTextNode(n));let s=r.shift(),i=s;e.replaceWith(s),r.forEach((e=>{i.parentNode.insertBefore(e,i.nextSibling),i=e})),r.length=0}_createReactiveTextNode(e,t){const o=new Function("obj",`with(obj) { return ${e}; }`),n=document.createTextNode(o(t)),r=this._findDependenciesInFragment(e),s=()=>{n.textContent=o(this.component)};return r.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),n}_findDependenciesInFragment(e){const t=/([A-Za-z][\w]+)/gm,o=[];let n;for(;n=t.exec(e);){const e=n[1];(this.properties.has(e)||this.computedProperties.has(e))&&o.push(e)}return o}}function s(e,t){let o=document.createElement("style");o.appendChild(document.createTextNode("")),e.appendChild(o);const n=e.styleSheets[0];return i(t,[":host"],n),n}function i(e,t,o){const n=[];t.forEach((e=>{e.startsWith(":")||e.startsWith(".")?n.push(e):n.push(" "+e.trim())}));let r=n.join("")+" {";return Object.keys(e).forEach((n=>{if("object"==typeof e[n])return t.push(n),i(e[n],t,o),void t.pop();r+=n.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))+": "+e[n]+";"})),r+="}","{}"!==r.trim()&&o.insertRule(r),r}const a={register(...e){e.forEach((e=>{if(void 0===e.__be_component__)throw new Error("The given argument is not a custom element.");var n,r;n=e,r=e.__be_component__,o.has(n)||(o.add(n),customElements.define(r.selector,class extends t{constructor(){super(n,r)}static get observedAttributes(){return r.attributes||[]}}))}))},install(e){e.install(a)}};e.AbstractComponent=class{constructor(e,t){this.$$=e,this.$root=e.attachShadow({mode:"open"}),this.$observer=new r(this,this.$root),this.$root.innerHTML=t.template,this.$style=s(this.$root,t.stylesheet||{})}onCreate(){}onDestroy(){}get __observer__(){return this.$observer}$query(e){return this.$root.querySelector(e)}$queryAll(e){return Array.from(this.$root.querySelectorAll(e))}$ref(e){const t=this.$query(e);if(t&&void 0!==t.__component__)return t.__component__}$emit(e,t){const o=new CustomEvent(e.toLowerCase(),{bubbles:!0,composed:!0,cancelable:!1,detail:t});this.$root.dispatchEvent(o)}},e.Component=function(e){return t=>{Object.defineProperty(t,"__be_component__",{configurable:!1,enumerable:!1,get:()=>e})}},e.Elements=a,e.Watch=function(e,t=!0){return(o,n)=>{void 0===o.constructor.__observerFunctions__&&Object.defineProperty(o.constructor,"__observerFunctions__",{enumerable:!1,configurable:!1,value:[]}),o.constructor.__observerFunctions__.push({propertyName:e,immediate:t,method:n})}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=elements.js.map
