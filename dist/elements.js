!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ByteshiftElements={})}(this,(function(e){"use strict";class t extends HTMLElement{constructor(e,t){super(),this.__attributes__={},this.__constructor__={c:e,o:t}}$nextTick(){return new Promise((e=>window.setTimeout((()=>e()),0)))}connectedCallback(){if(this.isConnected){if(void 0===this.__component__){const e=this.__constructor__.c,t=this.__constructor__.o;delete this.__constructor__,this.__component__=new e(this,t)}Object.keys(this.__attributes__).forEach((e=>{this.__component__[e]=this.__attributes__[e]})),this.__component__.__observer__.connect(),clearTimeout(this.__mountTimer__),this.__mountTimer__=setTimeout((()=>{this.__component__.__is_mounted__=!0,this.__component__.onCreate()}),0)}}disconnectedCallback(){clearTimeout(this.__mountTimer__),this.__component__.__is_mounted__=!1,this.__component__&&(this.__component__.onDestroy(),this.__component__.__observer__.disconnect())}attributeChangedCallback(e,t,o){const r=e.replace(/([-_][a-z])/g,(e=>e.toUpperCase().replace("-","").replace("_",""))),n=r.charAt(0).toLowerCase()+r.substr(1);t!==o&&(this.__attributes__[n]=o,this.__component__&&(this.__component__[n]=o))}}const o=new Set;function r(e,t,o){const r=t.getAttribute("bind"),n=t.tagName.toLowerCase();if(!e.hasProperty(r))throw new Error(`Cannot bind ${t.tagName.toLowerCase()} element to property ${r}. This property does not exist.`);if("input"!==n)return"textarea"===n?function(e,t,o,r){e.registerNodeEventListener(t,"change",(()=>{r[o]!==t.value&&(r[o]=t.value)})),e.registerNodeEventListener(t,"input",(()=>{r[o]!==t.value&&(r[o]=t.value)}));const n=e=>{t.value!==e&&(t.value=e)};e.addPropertyListener(o,n),n(r[o])}(e,t,r,o):"select"===n?function(e,t,o,r){if(t.hasAttribute("items")){const n=t.getAttribute("items");if(!e.hasProperty(n))throw new Error(`The items property "${n}" does not exist on the component ${e.component.constructor.name}.`);const s=()=>{const e=r[n],s=t.getAttribute("value-name")||"value",i=t.getAttribute("label-name")||"label";if(t.innerHTML="",Array.isArray(e))e.forEach((e=>{const o=document.createElement("option");"object"==typeof e?(o.innerText=e[i],o.value=e[s]):(o.innerText=e,o.value=e),t.appendChild(o)}));else{if("object"!=typeof e)throw new Error(`Items property ${n} must be either an array or object.`);Object.keys(e).forEach((o=>{const r=document.createElement("option");r.innerText=o,r.value=e[o],t.appendChild(r)}))}t.value=r[o]};e.addPropertyListener(n,s),s()}e.registerNodeEventListener(t,"change",(()=>{r[o]!==t.value&&(r[o]=t.value)}));const n=e=>{t.value!==e&&(t.value=e)};e.addPropertyListener(o,n),n(r[o])}(e,t,r,o):void 0;{const n=(t.getAttribute("type")||"text").toLowerCase(),s=t;switch(n){case"checkbox":return void function(e,t,o,r){e.registerNodeEventListener(t,"change",(()=>{r[o]!==t.checked&&(r[o]=t.checked)})),e.addPropertyListener(o,(e=>{t.checked!==e&&(t.checked=e)})),t.checked=!!r[o]}(e,s,r,o);case"text":case"password":case"color":case"time":case"date":case"datetime":return void function(e,t,o,r){e.registerNodeEventListener(t,"input",(()=>{r[o]!==t.value&&(r[o]=t.value)})),e.registerNodeEventListener(t,"change",(()=>{r[o]!==t.value&&(r[o]=t.value)})),e.addPropertyListener(o,(e=>{t.value!==e&&(t.value=e)})),t.setAttribute("value",r[o]),t.value=r[o]}(e,s,r,o);case"number":case"range":return void function(e,t,o,r){e.registerNodeEventListener(t,"input",(()=>{const e=parseFloat(t.value);r[o]!==e&&(r[o]=e)})),e.addPropertyListener(o,(e=>{t.value!==e&&(t.value=e)})),t.setAttribute("value",r[o]),t.value=r[o]}(e,s,r,o);case"radio":return void function(e,t,o,r){e.registerNodeEventListener(t,"change",(()=>{r[o]!==t.value&&(r[o]=t.value)}));const n=e=>{e===t.value?t.checked||(t.checked=!0):t.checked&&(t.checked=!1)};e.addPropertyListener(o,n),n(r[o])}(e,s,r,o);default:console.warn(`Unknown input element type: "${n}".`)}}}class n{constructor(e,t,o){this.component=e,this.root=t,this.attributes=o,this.properties=new Map,this.computedProperties=new Map,this.nodeEventMap=new Map,this.conditionals=new Set,this.textNodeListeners=new Set}connect(){this._initializeComponentReactivity();const e=this._iterateNode(this.root,this.component);setTimeout((()=>{for(let e of this.attributes)this.properties.set(e,{name:e,value:this.root.host.getAttribute(e),listeners:new Set});void 0!==this.component.constructor.__observerFunctions__&&this.component.constructor.__observerFunctions__.forEach((e=>{if(!this.properties.has(e.propertyName))throw new Error(`Cannot watch property "${e.propertyName}" through function ${e.method}, because this property does not exist.`);let t=!1;if(this.properties.get(e.propertyName).listeners.add((o=>{t||(t=!0,setTimeout((()=>{this.component.__is_mounted__&&this.component[e.method](o),t=!1}),0))})),e.immediate){if(t)return;t=!0,setTimeout((()=>{this.component.__is_mounted__&&this.component[e.method](this.properties.get(e.propertyName).value),t=!1}),0)}})),e.forEach((e=>this._injectPropertyReference(e.node,e.ctx))),e.clear(),setTimeout((()=>{this.conditionals.forEach((e=>e())),this.conditionals.clear()}),0)}),0)}disconnect(){this.nodeEventMap.forEach(((e,t)=>{e.forEach(((e,o)=>{e.forEach((e=>{t.removeEventListener(o,e)}))}))})),this.nodeEventMap.clear()}refreshTextNodes(){this.textNodeListeners.forEach((e=>e()))}hasProperty(e){return this.properties.has(e)}addPropertyListener(e,t){if(!this.hasProperty(e))throw new Error('Property "'+e+'" does not exist.');this.properties.get(e).listeners.add(t)}registerNodeEventListener(e,t,o){this.nodeEventMap.has(e)||this.nodeEventMap.set(e,new Map),this.nodeEventMap.get(e).has(t)||this.nodeEventMap.get(e).set(t,new Set),this.nodeEventMap.get(e).get(t).add(o),e.addEventListener(t,o)}_iterateNode(e,t,o=new Set){if(!e.hasAttribute||!e.hasAttribute("iterate")){if(e.childNodes.forEach((e=>{this._iterateNode(e,t,o)})),this._nodeHasPropertyReference(e)&&o.add({node:e,ctx:t}),1===e.nodeType){const o=e;this._bindEventHandlersToNode(o,t),this._bindConditionalsToNode(o,t),this._bindPropertiesToNode(o,t),this._bindEvaluatedAttributesToNode(o,t),this._bindReactiveStyleToNode(o,t),this._bindReactiveClassesToNode(o,t)}return o}this._createElementIterator(e,t)}_bindReactiveClassesToNode(e,t){if(!e.hasAttribute(":class"))return;const o=e.getAttribute(":class"),r=this._findDependenciesInFragment(o),n=new Function("obj","node",`with(obj) {\n            const data = ${o};\n            Object.keys(data).forEach((key) => {\n                if (data[key]) {\n                    if (! node.classList.contains(key)) {\n                        node.classList.add(key);\n                    }\n                } else {\n                    if (node.classList.contains(key)) {\n                        node.classList.remove(key);\n                    }\n                }\n            });\n        }`),s=()=>n(t,e);r.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),s()}_bindEvaluatedAttributesToNode(e,t){const o=e.getAttributeNames().filter((e=>e.startsWith(":")&&":style"!==e&&":class"!==e)).map((e=>e.substr(1)));0!==o.length&&o.forEach((o=>{const r=e.getAttribute(":"+o),n=new Function("obj",`with(obj) { return ${r}; }`),s=this._findDependenciesInFragment(r),i=()=>{const r=n(t);"boolean"==typeof r&&!1===r?e.removeAttribute(o):e.setAttribute(o,r)};s.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(i),this.computedProperties.has(e)&&this.computedProperties.get(e).add(i)})),i()}))}_createElementIterator(e,t){t=t||this.component;const o=e.getAttribute("iterate"),r=document.createComment("iterator:"+o),n=o.split(" in "),s=n[0].trim(),i=n[1].trim();if(e.removeAttribute("iterate"),e.replaceWith(r),!s||!i)throw new Error(`Invalid syntax in iterate directive. Expected "item in items", got "${o}"`);if(!this.hasProperty(i.trim()))throw new Error(`Property "${i}" does not exist in ${this.component.constructor.name}.`);const a=new Map,c=()=>{const o=t[i],n=new Set;let c=r;for(let i=0;i<o.length;i++){const h=o[i];if(n.add(h),a.has(h)){c=a.get(h);continue}const d=e.cloneNode(!0),p=Object.assign({},t,{[s]:h});this._getAllMethods(this.component).forEach((e=>{p[e]=t[e].bind(p)})),a.set(h,d),r.parentNode.insertBefore(d,c.nextSibling),c=d;const u=this._iterateNode(d,p);u.forEach((e=>this._injectPropertyReference(e.node,p))),u.clear()}const h=[];a.forEach(((e,t)=>{n.has(t)||h.push(t)})),h.forEach((e=>{a.get(e).remove(),a.delete(e)})),h.length=0,n.clear()};this.properties.get(i).listeners.add(c),setTimeout((()=>c()),0)}_getAllMethods(e){let t=[],o=e;do{t=t.concat(Object.getOwnPropertyNames(o))}while(o=Object.getPrototypeOf(o));return t.sort().filter((function(t,o,r){if(t!=r[o+1]&&"function"==typeof e[t])return!0}))}_bindReactiveStyleToNode(e,t){if(!e.hasAttribute(":style"))return;const o=e.getAttribute(":style"),r=this._findDependenciesInFragment(o),n=new Function("obj","node",`with(obj) {\n            const data = ${o};\n            Object.keys(data).forEach((key) => {\n                node.style[key] = data[key];\n            });\n        }`),s=()=>n(t,e);r.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),s()}_bindPropertiesToNode(e,t){e.hasAttribute("bind")&&r(this,e,t)}_bindConditionalsToNode(e,t){if(!e.hasAttribute("if"))return;const o=e.getAttribute("if"),r=new Function("obj",`with(obj) { return ${o}; }`),n=document.createComment(`{${e.tagName.toLowerCase()}}.if:(${o})`),s=this._findDependenciesInFragment(o);e.replaceWith(n),s.forEach((e=>{t[e]=this.properties.has(e)?this.properties.get(e).value:t[e]}));let i=!1;const a=()=>{i||(i=!0,s.forEach((e=>{t[e]=this.properties.has(e)?this.properties.get(e).value:t[e]})),setTimeout((()=>{r(t)?n.parentNode&&(n.replaceWith(e),i=!1):(e.replaceWith(n),i=!1)}),0))};s.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(a),this.computedProperties.has(e)&&this.computedProperties.get(e).add(a)})),this.conditionals.add(a)}_bindEventHandlersToNode(e,t){const o=e.getAttributeNames();this.nodeEventMap.has(e)||this.nodeEventMap.set(e,new Map);for(let r=0;r<o.length;r++)if(o[r].startsWith("@")){let n=e.getAttribute(o[r]);"function"==typeof this.component[n]&&(n+="($event instanceof CustomEvent ? $event.detail : $event)");const s=o[r].substr(1).toLowerCase(),i=new Function("obj","$event",`with(obj) { return ${n}; }`),a=e=>{const o=i(t,e);return"function"==typeof o?o(e):o};this.nodeEventMap.get(e).has(s)||this.nodeEventMap.get(e).set(s,new Set),this.nodeEventMap.get(e).get(s).add(a),e.addEventListener(s,a)}}_initializeComponentReactivity(){const e=(e,t)=>{void 0!==t.value&&"function"!=typeof t.value&&this._createReactiveProperty(e,t),"function"==typeof t.get&&this._createComputedProperty(e,t)},t=Object.getOwnPropertyDescriptors(this.component),o=Object.getOwnPropertyDescriptors(this.component.constructor.prototype);Object.keys(t).forEach((o=>e(o,t[o]))),Object.keys(o).forEach((t=>e(t,o[t])))}_createReactiveProperty(e,t){if(this.properties.has(e))return;this.properties.set(e,{name:e,value:void 0,listeners:new Set});const o=this.component[e];Object.defineProperty(this.component,e,{configurable:!0,enumerable:!0,get:()=>this.properties.get(e).value,set:t=>{const o=this.properties.get(e);o.value=t,o.listeners.forEach((e=>e(o.value))),Array.isArray(t)&&this._bindCallbackOnArrayModifications(t,(()=>{o.listeners.forEach((e=>e(o.value)))}))}}),this.component[e]=o}_bindCallbackOnArrayModifications(e,t){["pop","push","reverse","shift","unshift","splice","sort"].forEach((o=>{e[o]=function(){const r=Array.prototype[o].apply(e,arguments);return t.apply(e,arguments),r}}))}_createComputedProperty(e,t){if(this.computedProperties.has(e))return;let o,r=t.get.toString(),n=/this\.([A-Za-z0-9_]+)/gim,s=[];for(;o=n.exec(r);){const e=o[1].trim();this.properties.has(e)&&s.push(e)}this.computedProperties.set(e,new Set),s.forEach((t=>{this.properties.get(t).listeners.add((()=>{this.computedProperties.get(e).forEach((e=>e()))}))}))}_nodeHasPropertyReference(e){return 3===e.nodeType&&-1!==e.textContent.indexOf("{{")&&-1!==e.textContent.indexOf("}}")}_injectPropertyReference(e,t){let o=e.textContent,r="",n=[];for(let e=0;e<o.length;e++){const s=o[e],i=o[e+1];if("{"!==s||"{"!==i)if("}"!==s||"}"!==i)r+=s;else{e+=1;const o=r.trim();n.push(this._createReactiveTextNode(o,t)),r=""}else e+=1,n.push(document.createTextNode(r)),r=""}r.length>0&&n.push(document.createTextNode(r));let s=n.shift(),i=s;e.replaceWith(s),n.forEach((e=>{i.parentNode.insertBefore(e,i.nextSibling),i=e})),n.length=0}_createReactiveTextNode(e,t){const o=new Function("obj",`with(obj) { return ${e}; }`),r=document.createTextNode(o(t)),n=this._findDependenciesInFragment(e),s=()=>{r.textContent=o(this.component)};return this.textNodeListeners.add(s),n.forEach((e=>{this.properties.has(e)&&this.properties.get(e).listeners.add(s),this.computedProperties.has(e)&&this.computedProperties.get(e).add(s)})),r}_findDependenciesInFragment(e){const t=/([A-Za-z][\w]+)/gm,o=[];let r;for(;r=t.exec(e);){const e=r[1];(this.properties.has(e)||this.computedProperties.has(e))&&o.push(e)}return o}}function s(e,t){let o=document.createElement("style");o.appendChild(document.createTextNode("")),e.appendChild(o);const r=e.styleSheets[0];return"string"==typeof t?o.innerText=t:i(t,[":host"],r),r}function i(e,t,o){const r=[];t.forEach((e=>{e.startsWith(":")||e.startsWith(".")?r.push(e):r.push(" "+e.trim())}));let n=r.join("")+" {";return Object.keys(e).forEach((r=>{if("object"==typeof e[r])return t.push(r),i(e[r],t,o),void t.pop();n+=r.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))+": "+e[r]+";"})),n+="}","{}"!==n.trim()&&o.insertRule(n),n}const a={register(...e){e.forEach((e=>{if(void 0===e.__be_component__)throw new Error("The given argument is not a custom element.");var r,n;r=e,n=e.__be_component__,o.has(r)||(o.add(r),customElements.define(n.selector,class extends t{constructor(){super(r,n)}static get observedAttributes(){return n.attributes||[]}}))}))},install(e){e.install(a)}};e.AbstractComponent=class{constructor(e,t){this.$$=e,this.$root=e.attachShadow({mode:"open"}),this.$observer=new n(this,this.$root,t.attributes||[]),this.$root.innerHTML=t.template,this.$style=s(this.$root,t.stylesheet||{})}onCreate(){}onDestroy(){}get __observer__(){return this.$observer}$refreshTextNodes(){this.$observer.refreshTextNodes()}get $host(){return this.$root.host}$query(e){return this.$root.querySelector(e)}$queryAll(e){return Array.from(this.$root.querySelectorAll(e))}$ref(e){const t=this.$query(e);if(t&&void 0!==t.__component__)return t.__component__}$emit(e,t){const o=new CustomEvent(e.toLowerCase(),{bubbles:!0,composed:!0,cancelable:!1,detail:t});this.$root.dispatchEvent(o)}},e.Component=function(e){return t=>{Object.defineProperty(t,"__be_component__",{configurable:!1,enumerable:!1,get:()=>e})}},e.Elements=a,e.Watch=function(e,t=!0){return(o,r)=>{void 0===o.constructor.__observerFunctions__&&Object.defineProperty(o.constructor,"__observerFunctions__",{enumerable:!1,configurable:!1,value:[]}),o.constructor.__observerFunctions__.push({propertyName:e,immediate:t,method:r})}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=elements.js.map
